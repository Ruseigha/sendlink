version: "3.8"

services:
  # Development Environment
  app-dev:
    build: .
    container_name: shortlink-dev
    ports:
      - "8080:8080"
    environment:
      - ENVIRONMENT=development
      - SERVER_PORT=8080
      - DATABASE_URL=postgres://devuser:devpass@postgres-dev:5432/shortlink_dev?sslmode=disable
      - REDIS_URL=redis-dev:6379
      - BASE_URL=http://localhost:8080
    depends_on:
      - postgres-dev
      - redis-dev
    networks:
      - shortlink-network

  postgres-dev:
    image: postgres:15-alpine
    container_name: postgres-dev
    environment:
      - POSTGRES_USER=devuser
      - POSTGRES_PASSWORD=devpass
      - POSTGRES_DB=shortlink_dev
    ports:
      - "5432:5432"
    volumes:
      - postgres-dev-data:/var/lib/postgresql/data
    networks:
      - shortlink-network

  redis-dev:
    image: redis:7-alpine
    container_name: redis-dev
    ports:
      - "6379:6379"
    networks:
      - shortlink-network

  # Staging Environment
  app-staging:
    build: .
    container_name: shortlink-staging
    ports:
      - "8081:8080"
    environment:
      - ENVIRONMENT=staging
      - SERVER_PORT=8080
      - DATABASE_URL=postgres://staginguser:stagingpass@postgres-staging:5432/shortlink_staging?sslmode=disable
      - REDIS_URL=redis-staging:6379
      - BASE_URL=http://localhost:8081
    depends_on:
      - postgres-staging
      - redis-staging
    networks:
      - shortlink-network

  postgres-staging:
    image: postgres:15-alpine
    container_name: postgres-staging
    environment:
      - POSTGRES_USER=staginguser
      - POSTGRES_PASSWORD=stagingpass
      - POSTGRES_DB=shortlink_staging
    ports:
      - "5433:5432"
    volumes:
      - postgres-staging-data:/var/lib/postgresql/data
    networks:
      - shortlink-network

  redis-staging:
    image: redis:7-alpine
    container_name: redis-staging
    ports:
      - "6380:6379"
    networks:
      - shortlink-network

volumes:
  postgres-dev-data:
  postgres-staging-data:

networks:
  shortlink-network:
    driver: bridge
